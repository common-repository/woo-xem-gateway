{"version":3,"sources":["xem-checkout.js"],"names":["$","xemPayment","init","initialize","length","this","form","email","data","amount","currency","xemAddress","xemAmount","xemRef","infoWrapper","amountWrapper","process","paymentData","v","wc_xem_params","test","type","addr","toUpperCase","replace","msg","name","store","QRCode","text","JSON","stringify","size","fill","quiet","ratio","Clipboard","isSupported","is","attr","on","options","classname","id","target","document","getElementById","nanobar","Nanobar","updateXemAmount","ajaxGetXemAmount","done","res","console","log","success","checkForXemPayment","go","ajax","url","wc_ajax_url","action","nounce","html","match","trigger","setTimeout","jQuery"],"mappings":"CAAA,SAAAA,GACA,GAAAC,IACAC,KAAA,WAEAF,EAAAG,WAAA,UAAA,WAEAH,EAAA,aAAAI,SACAC,KAAAC,KAAAN,EAAA,aACAK,KAAAE,MAAAF,KAAAC,KAAAE,KAAA,SACAH,KAAAI,OAAAJ,KAAAC,KAAAE,KAAA,UACAH,KAAAK,SAAAL,KAAAC,KAAAE,KAAA,YACAH,KAAAM,WAAAN,KAAAC,KAAAE,KAAA,eACAH,KAAAO,UAAAP,KAAAC,KAAAE,KAAA,cACAH,KAAAQ,OAAAR,KAAAC,KAAAE,KAAA,WACAH,KAAAS,YAAA,YACAT,KAAAU,cAAA,sBACAV,KAAAW,QAAA,gBAKAX,KAAAY,aACAC,EAAAC,cAAAC,KAAA,EAAA,EACAC,KAAA,EACAb,MACAc,KAAAjB,KAAAM,WAAAY,cAAAC,QAAA,KAAA,IACAf,OAAA,IAAAJ,KAAAO,UACAa,IAAApB,KAAAQ,OACAa,KAAA,kBAAAP,cAAAQ,QAIA,GAAAC,QAAA,UACAC,KAAAC,KAAAC,UAAA1B,KAAAY,aACAe,KAAA,IACAC,KAAA,OACAC,MAAA,EACAC,MAAA,IAIAC,UAAAC,gBACA,GAAAD,WAAA,uBACA,GAAAA,WAAA,wBACA,GAAAA,WAAA,qBAIApC,EAAA,sCAAAsC,GAAA,YACAtC,EAAA,gBAAAuC,KAAA,YAAA,GAEAvC,EAAA,gBAAAuC,KAAA,YAAA,GAIAvC,EAAA,6BAAAwC,GAAA,QAAA,+BAAA,WACAxC,EAAAK,MAAAiC,GAAA,uBACAtC,EAAA,gBAAAuC,KAAA,YAAA,GAEAvC,EAAA,gBAAAuC,KAAA,YAAA,IAIA,IAAAE,IACAC,UAAA,cACAC,GAAA,cACAC,OAAAC,SAAAC,eAAA,eAGA7C,GAAA8C,QAAA,GAAAC,SAAAP,MAKAQ,gBAAA,WACA5C,KAAA6C,mBAAAC,KAAA,SAAAC,GACAC,QAAAC,IAAAF,IAEA,IAAAA,EAAAG,SAAAH,EAAA5C,KAAAC,OAAA,GACAT,EAAAK,KAAAU,eAAAc,KAAAuB,EAAA5C,KAAAC,WAKA+C,mBAAA,WACAnD,KAAA0C,QAAAU,GAAA,IACAzD,EAAA0D,MACAC,IAAAxC,cAAAyC,YACAvC,KAAA,OACAb,MACAqD,OAAA,gCACAC,OAAA3C,cAAA2C,UAEAX,KAAA,SAAAC,GACApD,EAAA,cAAA+D,KAAA,qCAGA,IAAAX,EAAAG,UAAA,IAAAH,EAAA5C,KAAAwD,QACAhE,EAAA,gBAAAuC,KAAA,YAAA,GACAvC,EAAA,gBAAAiE,QAAA,UAEAC,WAAA,WACAjE,EAAAuD,sBACA,OAEAnD,KAAA0C,QAAAU,GAAA,MAGAP,iBAAA,WACA,MAAAlD,GAAA0D,MACAC,IAAAxC,cAAAyC,YACAvC,KAAA,OACAb,MACAqD,OAAA,6BACAC,OAAA3C,cAAA2C,WAMA7D,GAAAC,OACAgE,WAAA,WACAjE,EAAAuD,sBACA,MAEAW","file":"../xem-checkout.min.js","sourcesContent":["(function( $ ) {\r\n    var xemPayment = {\r\n        init: function () {\r\n\r\n            $.initialize(\"#xem-qr\", function() {\r\n                //Get form\r\n                if ( $( '#xem-form' ).length ) {\r\n                    this.form = $('#xem-form');\r\n                    this.email = this.form.data('email');\r\n                    this.amount = this.form.data('amount');\r\n                    this.currency = this.form.data('currency');\r\n                    this.xemAddress = this.form.data('xem-address');\r\n                    this.xemAmount = this.form.data('xem-amount');\r\n                    this.xemRef = this.form.data('xem-ref');\r\n                    this.infoWrapper = '#xem-info';\r\n                    this.amountWrapper = '#xem-amount-wrapper';\r\n                    this.process = '#xem-process';\r\n                }\r\n\r\n                //Prepare NEM qr code data\r\n                // Invoice model for QR\r\n                this.paymentData = {\r\n                    \"v\": wc_xem_params.test ? 1 : 2,\r\n                    \"type\": 2,\r\n                    \"data\": {\r\n                        \"addr\": this.xemAddress.toUpperCase().replace(/-/g, ''),\r\n                        \"amount\": this.xemAmount * 1000000,\r\n                        \"msg\": this.xemRef,\r\n                        \"name\": \"XEM payment to \" + wc_xem_params.store\r\n                    }\r\n                };\r\n                //Generate the QR code with address\r\n                new QRCode(\"xem-qr\", {\r\n                    text: JSON.stringify(this.paymentData),\r\n                    size: 256,\r\n                    fill: '#000',\r\n                    quiet: 0,\r\n                    ratio: 2\r\n                });\r\n\r\n                /*Add copy functinality to amount, ref and nem address*/\r\n                if(Clipboard.isSupported()){\r\n                    new Clipboard('#xem-amount-wrapper');\r\n                    new Clipboard('#xem-address-wrapper');\r\n                    new Clipboard('#xem-ref-wrapper');\r\n                }\r\n\r\n                //Set payment button to disabled if whole chech is updated.\r\n                if($( 'div.payment_box.payment_method_xem' ).is(':visible')){\r\n                    $( '#place_order' ).attr( 'disabled', true);\r\n                }else{\r\n                    $( '#place_order' ).attr( 'disabled', false)\r\n                }\r\n\r\n                /*Set pay button to disabled and start waiting for payments*/\r\n                $('.wc_payment_methods  > li').on( 'click', 'input[name=\"payment_method\"]',function () {\r\n                    if ( $( this ).is( '#payment_method_xem' ) ) {\r\n                        $( '#place_order' ).attr( 'disabled', true);\r\n                    }else{\r\n                        $( '#place_order' ).attr( 'disabled', false)\r\n                    }\r\n                });\r\n\r\n                var options = {\r\n                    classname: 'nanobar-xem',\r\n                    id: 'xem-nanobar',\r\n                    target: document.getElementById('xem-process')\r\n                };\r\n\r\n                xemPayment.nanobar = new Nanobar( options );\r\n            });\r\n\r\n\r\n        },\r\n        updateXemAmount: function () {\r\n            this.ajaxGetXemAmount().done(function (res) {\r\n                console.log(res);\r\n\r\n                if(res.success === true && res.data.amount > 0){\r\n                    $(this.amountWrapper).text(res.data.amount)\r\n                }\r\n            });\r\n\r\n        },\r\n        checkForXemPayment: function () {\r\n            this.nanobar.go(25);\r\n            $.ajax({\r\n                url: wc_xem_params.wc_ajax_url,\r\n                type: 'post',\r\n                data: {\r\n                    action: 'woocommerce_check_for_payment',\r\n                    nounce: wc_xem_params.nounce\r\n                }\r\n            }).done(function (res) {\r\n                $('#xem-check').html('<p id=\"xem-check\">Checking..</p>');\r\n                //console.log(res);\r\n                //console.log(\"Match: \" + res.data.match);\r\n                if(res.success === true && res.data.match === true){\r\n                    $( '#place_order' ).attr( 'disabled', false);\r\n                    $( '#place_order' ).trigger( 'click');\r\n                }\r\n                setTimeout(function() {\r\n                    xemPayment.checkForXemPayment();\r\n                }, 5000);\r\n            });\r\n            this.nanobar.go(100);\r\n        },\r\n\r\n        ajaxGetXemAmount: function () {\r\n            return $.ajax({\r\n                url: wc_xem_params.wc_ajax_url,\r\n                type: 'post',\r\n                data: {\r\n                    action: 'woocommerce_get_xem_amount',\r\n                    nounce: wc_xem_params.nounce\r\n                }\r\n            })\r\n        }\r\n    };\r\n\r\n    xemPayment.init();\r\n    setTimeout(function() {\r\n        xemPayment.checkForXemPayment();\r\n    }, 5000);\r\n\r\n})( jQuery );"]}